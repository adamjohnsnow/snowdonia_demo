<div class="top-box project-header">
  <img src="fs_logo_title.jpg" width="320">
</div>
<div class="hide-print top-box project-header" style=>
  <h3>Actions</h3>
  <a href="/download?report=user_<%= session[:user_id ].to_s + '_' + @project.project.title %>_<%= @project.version_name %>_ordersheet.csv" style="color: #322B6A;">
    <i class="fas fa-cloud-download-alt"></i> CSV
  </a>
  <br>
  <div onclick="printReport()" style="color: #322B6A; cursor: pointer;"><i class="fas fa-print"></i> PRINT</div>
  <a href="/project-summary?project_id=<%= @project.project.id %>&version_id=<%= @project.id %>">Back to Summary</a>
</div>
<h3>Ordersheet</h3>
<h2><%= @project.project.title %></h2>
<div class="top-box">
  <div class="table">
      <div class="table-row">
        <div class="table-cell">
          Project Title: <%= @project.project.title %>
        </div>
        <div class="table-cell">
          Status: <%= @project.status %>
        </div>
      </div>
      <div class="table-row">
        <div class="table-cell">
          Job Code: <%= @project.project.job_code %>
        </div>
        <div class="table-cell">
          Factory Settings PM: <%= @project.project.user.firstname %> <%= @project.project.user.surname %>
        </div>
      </div>
      <div class="table-row">
        <div class="table-cell">
          Workshop Deadline: <%= @project.project.workshop_deadline.strftime("%d/%m/%Y") %>
        </div>
        <div class="table-cell">
          Client: <%= @project.project.client.name %>
        </div>
      </div>
      <div class="table-row">
        <div class="table-cell">
          On Site Deadline: <%= @project.project.on_site.strftime("%d/%m/%Y") %>
        </div>
        <div class="table-cell">
          Site: <%= @project.project.site.name %>
        </div>
      </div>
      <div class="table-row">
        <div class="table-cell">
          Project Summary<br>
          <textarea cols="50" rows="3" name="summary"><%= @project.project.summary %></textarea>
        </div>
        <div class="table-cell">
          Technical Site Requirements<br>
          <textarea cols="50" rows="3" name="technical_requirements"><%= @project.project.technical_requirements %></textarea>
        </div>
      </div>
    </div>
</div>
<br>
<div class="table">
  <div class="table-row header-row">
    <div class="table-cell" style="width: 55px;">
      Costcode
    </div>
    <div class="table-cell" style="min-width: 280px;">
      Description
    </div>
    <div class="table-cell" style="width: 125px;">
      Unit Cost
    </div>
    <div class="table-cell" style="width: 55px;">
      Qty
    </div>
    <div class="table-cell" style="width: 125px;">
      Total Cost
    </div>
  </div>
<% @materials.materials.costcodes.all.each do |cc| %>
  <% @materials.materials.all(:costcode_id => cc.id).each do |mat|
    element_materials = @materials.all(:material_id => mat.id) %>
      <div class="table-row <%= cc.code %>">
        <div class="table-cell">
          <%= cc.code %>
        </div>
        <div class="table-cell">
          <%= mat.description %> (<%= mat.supplier %>)
        </div>
        <div class="table-cell">
          £<%= sprintf('%.2f', element_materials[0].price) %> per <%= mat.unit %>
        </div>
        <div class="table-cell">
          <%= element_materials.sum(:units) %>
        </div>
        <div class="table-cell">
          £<%= sprintf('%.2f', element_materials.sum(:units) * element_materials[0].price) %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
<script>
var printReport = function(){
  document.getElementsByClassName('menu')[0].style.display = 'none';
  var hides1 = document.getElementsByClassName('hide-print');
  for (i = 0; i < hides1.length; i++) {
    var remember1 = hides1[i].style.display
    hides1[i].style.display = 'none';
  }
  document.body.style.backgroundColor = "white"
  window.print();
  document.getElementsByClassName('menu')[0].style.display = 'table-cell';
  for (i = 0; i < hides1.length; i++) {
    hides1[i].style.display = remember1;
  }
  document.body.style.backgroundColor = "#eeeeee40"
}
</script>

<%= erb :report_header %>
<h3>Ordersheet</h3>
<br>
<div class="table">
  <div class="table-row header-row">
    <div class="table-cell" style="width: 55px;">
      Costcode
    </div>
    <div class="table-cell" style="min-width: 280px;">
      Description
    </div>
    <div class="table-cell" style="width: 125px;">
      Unit Cost
    </div>
    <div class="table-cell" style="width: 55px;">
      Qty
    </div>
    <div class="table-cell" style="width: 125px;">
      Total Cost
    </div>
  </div>
<% @materials.materials.costcodes.all.each do |cc| %>
  <% @materials.materials.all(:costcode_id => cc.id).each do |mat|
    element_materials = @materials.all(:material_id => mat.id) %>
      <div class="table-row <%= cc.code %>">
        <div class="table-cell">
          <%= cc.code %>
        </div>
        <div class="table-cell">
          <%= mat.description %> (<%= mat.supplier %>)
        </div>
        <div class="table-cell">
          £<%= sprintf('%.2f', element_materials[0].price) %> per <%= mat.unit %>
        </div>
        <div class="table-cell">
          <%= element_materials.sum(:units) %>
        </div>
        <div class="table-cell">
          £<%= sprintf('%.2f', element_materials.sum(:units) * element_materials[0].price) %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
